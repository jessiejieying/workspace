<script>var groupId=QueryURL.GetValue('groupId');&#13;&#10;var wfId=QueryURL.GetValue('wfId');&#13;&#10;var oldRecNum=0;&#13;&#10;var oldYear=0;&#13;&#10;function load()&#13;&#10;{&#13;&#10;    var dash=  QueryURL.GetValue('dash');&#13;&#10;	 var noString=  QueryURL.GetValue('noString');&#13;&#10;    var selectDash=$('#textDash').val();&#13;&#10;	 if(dash)   &#13;&#10;    {&#13;&#10;         $('#sel_dropdownlist1').val(dash)&#13;&#10;   }&#13;&#10;	if(selectDash)&#13;&#10;	{&#13;&#10;	    $('#sel_dropdownlist1').val(selectDash)&#13;&#10;		$('#button1').hide();&#13;&#10;	}&#13;&#10;   &#13;&#10;   if(noString)   &#13;&#10;    {&#13;&#10;         $('#text9').val(decodeURI(noString))&#13;&#10;   }&#13;&#10;    oldRecNum=$('#text7').val();&#13;&#10;	oldYear=$('#text6').val();&#13;&#10;	&#13;&#10;	if(!oldRecNum)&#13;&#10;	{&#13;&#10;	   changeDash();&#13;&#10;	   $('#button2').hide();&#13;&#10;	}&#13;&#10;	$('#sel_dropdownlist2').hide();&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function changeDash()&#13;&#10;{&#13;&#10;&#13;&#10;   var dash= $('#sel_dropdownlist1').val();&#13;&#10;   var year=$('#text6').val();&#13;&#10;   var url = project+"/admin/documentConfig/selectIsHasDocNo.action";&#13;&#10;   	var data="groupId="+groupId+"&wfId="+wfId+"&dashValue="+dash+"&year="+year;&#13;&#10;    $.post(url,data,function(result){&#13;&#10;&#13;&#10;		if(result)&#13;&#10;		{&#13;&#10;	        if(result.result=="hasNo")&#13;&#10;	        {&#13;&#10;			    &#13;&#10;			    alert("当前公文已经编过号，请先删除编号");&#13;&#10;				 var dash=  QueryURL.GetValue('dash');&#13;&#10;			  $('#sel_dropdownlist1').val(dash);&#13;&#10;			}else{&#13;&#10;			   url = project+"/admin/documentConfig/getDocNoInfoWithoutSave.action";&#13;&#10;			   $.post(url,data,function(result){&#13;&#10;&#13;&#10;					if(result)&#13;&#10;					{&#13;&#10;					 $('#text7').val(result.recNum)&#13;&#10;					 $('#text9').val(result.noString)&#13;&#10;					 oldRecNum=result.recNum; &#13;&#10;					 &#13;&#10;					}&#13;&#10;					&#13;&#10;				});&#13;&#10;			}&#13;&#10;		}else{&#13;&#10;		   alert("访问失败");&#13;&#10;		}&#13;&#10;		&#13;&#10;	});&#13;&#10;  	 $('#sel_dropdownlist2').hide();&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function checkConflict()&#13;&#10;{&#13;&#10;&#13;&#10;   var dash= $('#sel_dropdownlist1').val();&#13;&#10;   var year=$('#text6').val();&#13;&#10;   var recNum=$('#text7').val();&#13;&#10;   if(isNaN(year)||isNaN(recNum))&#13;&#10;   {&#13;&#10;      alert("序列号或年份要为数字")&#13;&#10;	 resetNum()&#13;&#10;      return;&#13;&#10;   }&#13;&#10;   &#13;&#10;     var url = project+"/admin/documentConfig/selectIsHasDocNo.action";&#13;&#10;   	var data="groupId="+groupId+"&wfId="+wfId+"&dashValue="+dash+"&year="+year;&#13;&#10;    $.post(url,data,function(result){&#13;&#10;&#13;&#10;		if(result)&#13;&#10;		{&#13;&#10;	        if(result.result=="hasNo")&#13;&#10;	        {&#13;&#10;			    &#13;&#10;			    alert("当前公文已经编过号，请先删除编号");&#13;&#10;				 resetNum()&#13;&#10;			}else{&#13;&#10;			   url = project+"/admin/documentConfig/selectCheckOtherHasRecnum.action";&#13;&#10;				data="groupId="+groupId+"&dashValue="+dash+"&year="+year+"&recNum="+recNum;&#13;&#10;				 $.post(url,data,function(result){&#13;&#10;&#13;&#10;					if(result)&#13;&#10;					{&#13;&#10;						if(result.result=="hasConflict")&#13;&#10;						{&#13;&#10;							&#13;&#10;							alert("此序列号其他公文已占用");&#13;&#10;							resetNum()&#13;&#10;						}else if(result.result=="noConflict")&#13;&#10;						{&#13;&#10;						     changeNoString()&#13;&#10;						}&#13;&#10;					}else{&#13;&#10;					   alert("访问失败");&#13;&#10;					}&#13;&#10;		&#13;&#10;				});&#13;&#10;			   &#13;&#10;			   &#13;&#10;			}&#13;&#10;		}else{&#13;&#10;		   alert("访问失败");&#13;&#10;		}&#13;&#10;		&#13;&#10;	});&#13;&#10;	&#13;&#10;&#13;&#10;   &#13;&#10;}&#13;&#10;&#13;&#10;function resetNum()&#13;&#10;{&#13;&#10;   $('#text7').val(oldRecNum);&#13;&#10;	$('#text6').val(oldYear);&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;function sub()&#13;&#10;{&#13;&#10;   var dash= $('#sel_dropdownlist1').val();&#13;&#10;   var year=$('#text6').val();&#13;&#10;    var recNum=$('#text7').val();&#13;&#10;   &#13;&#10;    var url = project+"/admin/documentConfig/doSaveDocNo.action";&#13;&#10;	var data="groupId="+groupId+"&wfId="+wfId+"&dashValue="+dash+"&year="+year+"&recNum="+recNum;&#13;&#10;   $.post(url,data,function(result){&#13;&#10;&#13;&#10;		if(result)&#13;&#10;		{&#13;&#10;		   $.dialog.tips(result.msg);&#13;&#10;		   if(result.result=='success')&#13;&#10;		   {&#13;&#10;		   &#13;&#10;		   	setTimeout(function(){&#13;&#10;			   try{&#13;&#10;					window.edenCallBack();&#13;&#10;&#13;&#10;				}catch (e){&#13;&#10;&#13;&#10;				}&#13;&#10;			 },300);&#13;&#10;		       &#13;&#10;				&#13;&#10;		   }&#13;&#10;		}else{&#13;&#10;			$.dialog.tips("访问失败");&#13;&#10;		}&#13;&#10;		&#13;&#10;	});&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;function del()&#13;&#10;{&#13;&#10;&#13;&#10; &#13;&#10;   	var url=project + '/form/fceform/common/run.html?djsn=oa_edit_document_del_no&djtype=eden_wf';&#13;&#10;	url+="&wfId="+wfId+"&groupId="+groupId;&#13;&#10;	createWindow({&#13;&#10;		text    :'删除编号',&#13;&#10;		url     :url,&#13;&#10;		id      :'delDocumentNo',&#13;&#10;		width   :'390',&#13;&#10;		height  :'200',&#13;&#10;		//parent_window:window,&#13;&#10;		callBack:function () {&#13;&#10;		 &#13;&#10;			 window.closeWin('delDocumentNo');&#13;&#10;			parent.location.reload();&#13;&#10;	        &#13;&#10;			&#13;&#10;			&#13;&#10;	     }&#13;&#10;	});&#13;&#10;	&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;/**&#13;&#10; * 获取断号&#13;&#10; */&#13;&#10;function putCutNo()&#13;&#10;{&#13;&#10;	   var dash= $('#sel_dropdownlist1').val();&#13;&#10;   var year=$('#text6').val();&#13;&#10;	&#13;&#10;	var url = project+"/admin/documentConfig/getDocCutNo.action";&#13;&#10;	var data="groupId="+groupId+"&wfId="+wfId+"&dashValue="+dash+"&year="+year;&#13;&#10;	$.post(url,data,function(result){&#13;&#10;&#13;&#10;		if(result.data)&#13;&#10;		{&#13;&#10;			var list=result.data;&#13;&#10;			var html="<option value='-1'> </option>";&#13;&#10;			for(var i=0;i<list.length;i++)&#13;&#10;			{&#13;&#10;				 html+="<option value='"+list[i].recnum+"'>"+list[i].recnum+"</option>";&#13;&#10;			}&#13;&#10;			&#13;&#10;			if(list.length==0)&#13;&#10;			{&#13;&#10;			  html="<option value='-1'>无</option>";&#13;&#10;			}&#13;&#10;			$('#sel_dropdownlist2').html(html);&#13;&#10;			$('#sel_dropdownlist2').show();&#13;&#10;		}&#13;&#10;		&#13;&#10;	});&#13;&#10;	&#13;&#10;	&#13;&#10;}&#13;&#10;&#13;&#10;//点击断号时自动填充&#13;&#10;function fillNum()&#13;&#10;{&#13;&#10;    var val=$('#sel_dropdownlist2').val();&#13;&#10;    if(val!=-1)&#13;&#10;	{&#13;&#10;	   $('#text7').val(val) &#13;&#10;       checkConflict();&#13;&#10;	}&#13;&#10;    &#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function changeNoString()&#13;&#10;{&#13;&#10;    var dash= $('#sel_dropdownlist1').val();&#13;&#10;   var year=$('#text6').val();&#13;&#10;    var recNum=$('#text7').val();&#13;&#10;   &#13;&#10;    var url = project+"/admin/documentConfig/getDocNoStringByMontage.action";&#13;&#10;	var data="groupId="+groupId+"&wfId="+wfId+"&dashValue="+dash+"&year="+year+"&recNum="+recNum;&#13;&#10;   $.post(url,data,function(result){&#13;&#10;&#13;&#10;		if(result)&#13;&#10;		{&#13;&#10;		     $('#text9').val(result.noString)&#13;&#10;			 oldRecNum=recNum;  &#13;&#10;  &#13;&#10;		}else{&#13;&#10;			$.dialog.tips("访问失败");&#13;&#10;		}&#13;&#10;		&#13;&#10;	});&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;function getCurYear()&#13;&#10;{&#13;&#10;   return new Date().getFullYear();&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true jslib userType BLONopenBefore BLONclose center="  " BLONopen="load()" unselectable="on" toolbar="不带工具栏" dj_sn="oa_edit_document_no" type="eden_wf" caption="编号" window="当前窗口" posleft postop poswidth posheight isfile="是" billtaborder="<root><taborder>button1</taborder><taborder>button2</taborder><taborder>text6</taborder><taborder>text7</taborder><taborder>text9</taborder><taborder>dropdownlist1</taborder><taborder>button3</taborder><taborder>textDash</taborder><taborder>dropdownlist2</taborder></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:7;radio:0;listbox:0;textarea:1;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:0;button:3;text:10;hr:0;checkboxlist:0;radiolist:0;dropdownlist:2;grid:0;dataset:1;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0;editor:0" contxml="<root><label><id>label1</id><id>label2</id><id>label5</id><id>label6</id></label><button><id>button1</id><id>button2</id><id>button3</id></button><text><id>text6</id><id>text7</id><id>text9</id><id>textDash</id></text><dropdownlist><id>dropdownlist1</id><id>dropdownlist2</id></dropdownlist><dataset><id>dataset1</id></dataset></root>" alertType="1" isCheckPermit="否"><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 65px; HEIGHT: 23px; TOP: 29px; LEFT: 27px" id=label1 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() inputTag="否" controltype="label">机关代字：</LABEL><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 65px; HEIGHT: 15px; TOP: 70px; LEFT: 28px" id=label2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() inputTag="否" controltype="label">编号年份：</LABEL><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="BACKGROUND-IMAGE: url(none); POSITION: absolute; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; WIDTH: 57px; PADDING-RIGHT: 0px; BACKGROUND-REPEAT: no-repeat; BACKGROUND-POSITION: 0px 0px; HEIGHT: 25px; TOP: 69px; PADDING-TOP: 0px; LEFT: 337px" id=button1 onresize=resize() onmove=move() class=ef_button onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("putCutNo()")'>漏号</BUTTON><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 32px; HEIGHT: 32px; TOP: 201px; LEFT: 537px" id=dataset1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" async="否" controltype="dataset" datasourceName isInAddStatus="是" idtype="1" opensortno="1" masterdsfield masterds subdsfield issubds="否" idparam="BBB" savetable="oa_count_increase_num" submitno="1" submittype="4" isaddemptyrec="否" formatxml='<root><tr rowstate="add"><td>type_one</td><td>编号类型</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>type_two</td><td>机关代字</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>type_three</td><td>年份</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td>getCurYear()</td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>id</td><td>id</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>judge_value</td><td>wfId</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>recnum</td><td>序列号</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' pubpara="否" opensql="select * from oa_count_increase_num&#13;&#10;where type_one= ':{$urlParam(&quot;groupId&quot;)}:'  and judge_value=':{$urlParam(&quot;wfId&quot;)}:' and data_valid=1" AfterScroll BeforeScroll AfterPost BeforePost BeforeOpen AfterOpen saveastable isSubGrid="否"><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="BACKGROUND-IMAGE: url(none); POSITION: absolute; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; WIDTH: 71px; PADDING-RIGHT: 0px; BACKGROUND-REPEAT: no-repeat; BACKGROUND-POSITION: 0px 0px; HEIGHT: 25px; TOP: 120px; PADDING-TOP: 0px; LEFT: 336px" id=button2 onresize=resize() onmove=move() class=ef_button onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("del()")'>删除文号</BUTTON> 
<DIV onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 316px; HEIGHT: 26px; TOP: 27px; LEFT: 97px; ButtonWidth: 10" id=dropdownlist1 class=ef_design_dropdownlist onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() onchange='bill_onclick("changeDash()")' controltype="dropdownlist" datasourceName sql="select   display_name, dict_value from ea_data_dictionary where dict_group_id = 'oa_send_document_swung_dash' order by dict_seq " temptext tempvalue check="2" FieldNameList isTreeNewSql="0" rootNodeId="rootNode" isShowTree="0" xml src="../images/ef_designer_fccode.gif" multiselect="否" addrow="否" blnempty="否" blninput="是" visible="是" format></DIV><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 75px; HEIGHT: 21px; TOP: 73px; LEFT: 99px" id=text6 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() onchange='bill_onclick("checkConflict()")' value=年份 size=12 controltype="text" field="type_three" china="年份" dataset="dataset1"><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 65px; HEIGHT: 15px; TOP: 72px; LEFT: 205px" id=label5 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() inputTag="否" controltype="label">序号：</LABEL><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 65px; HEIGHT: 24px; TOP: 71px; LEFT: 254px" id=text7 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() onchange='bill_onclick("checkConflict()")' value=序列号 size=11 controltype="text" field="recnum" china="序列号" dataset="dataset1"><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 65px; HEIGHT: 15px; TOP: 121px; LEFT: 26px" id=label6 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() inputTag="否" controltype="label">文件字号：</LABEL><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 222px; HEIGHT: 25px; TOP: 119px; LEFT: 99px" id=text9 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() readOnly size=38 controltype="text"><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="BACKGROUND-IMAGE: url(none); POSITION: absolute; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; WIDTH: 75px; PADDING-RIGHT: 0px; BACKGROUND-REPEAT: no-repeat; BACKGROUND-POSITION: 0px 0px; HEIGHT: 25px; TOP: 207px; PADDING-TOP: 0px; LEFT: 184px" id=button3 onresize=resize() onmove=move() class=ef_button onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("sub()")'>保存编号</BUTTON><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 94px; DISPLAY: none; HEIGHT: 20px; TOP: 42px; LEFT: 467px" id=textDash onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() value=机关代字 size=17 controltype="text" field="type_two" china="机关代字" dataset="dataset1"> 
<DIV onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 67px; HEIGHT: 20px; TOP: 96px; LEFT: 338px; ButtonWidth: 10" id=dropdownlist2 class=ef_design_dropdownlist onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() onchange='bill_onclick("fillNum(this)")' controltype="dropdownlist" datasourceName sql temptext="无" tempvalue="-1" check="1" FieldNameList isTreeNewSql="0" rootNodeId="rootNode" isShowTree="0" xml="<tr height='20px' ><td>无</td><td>-1</td></tr>" src="../images/ef_designer_fccode.gif" multiselect="否" addrow="否" blnempty="否" blninput="是" visible="否" format></DIV></DIV>