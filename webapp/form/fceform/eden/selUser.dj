<script>function changeOrgRole() {&#13;&#10;&#13;&#10;     var roleTreeValue=$('#sel_roleTree').val();&#13;&#10;     if(roleTreeValue==-1)&#13;&#10;    {&#13;&#10;    &#13;&#10;	var id=window.selTree_tree.getSelectedItemId();&#13;&#10;     	var org_code=window.selTree_tree.getUserData(id,'org_code');&#13;&#10;        if(!org_code)&#13;&#10;        {&#13;&#10;          org_code="";&#13;&#10;        }&#13;&#10;	var sql = "SELECT a.account_name, a.account_name user_name FROM ea_account_info a  WHERE a.dep_code LIKE '"+org_code+"%'";&#13;&#10;	 refreshDs1(sql)&#13;&#10;    }else{&#13;&#10;      changeRole()&#13;&#10;&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;function refreshDs1(sql)&#13;&#10;{&#13;&#10;     setDsSql('ds1', sql);&#13;&#10;	refreshDsById('ds1');&#13;&#10;}&#13;&#10;&#13;&#10;/*&#13;&#10;//根据角色的配置来显示用户&#13;&#10;function loadRoleUserFromConfig()&#13;&#10;{&#13;&#10;	 var grid=getGrid('grid1');&#13;&#10;	 var pRowIdVal="";&#13;&#10;	 var pRowId = grid.getAllRowIds(',').split(',');&#13;&#10;	 var pre_count=pRowId.length;&#13;&#10;	 alert(pre_count)&#13;&#10;	 for(i=0;i<pRowId.length;i++){ &#13;&#10;	        	pRowIdVal = pRowIdVal + pRowId[i] + "-";&#13;&#10;	  }&#13;&#10;&#13;&#10;      var ds=getDs('roleDataset');&#13;&#10;   var count = ds.dataCount();&#13;&#10; &#13;&#10;   	for (var i = 0; i < count; i++) {&#13;&#10;       var id = ds.idByIndex(i);&#13;&#10;		var dataItem=ds.item(id);&#13;&#10;		var account_name=dataItem.account_name;&#13;&#10;		var user_name=dataItem.user_name;&#13;&#10;		if( pRowIdVal.indexOf(account_name) < 0){  //用来防止重复&#13;&#10;		 alert(account_name);&#13;&#10;			grid.addRow(account_name,[ ,account_name,user_name],i+pre_count); &#13;&#10;&#13;&#10;		}&#13;&#10;	&#13;&#10;	}&#13;&#10;	&#13;&#10;  &#13;&#10;  &#13;&#10;}&#13;&#10;*/&#13;&#10;&#13;&#10;function changeRole()&#13;&#10;{&#13;&#10;   &#13;&#10;    var roleTreeValue=$('#sel_roleTree').val();&#13;&#10;	if(roleTreeValue!=-1)&#13;&#10;    {&#13;&#10;		var sql="SELECT b.account_name , b.account_name user_name FROM  ea_account_info b  LEFT JOIN ea_account_role_relation c ON c.account_name = b.account_name where c.role_id = '"+roleTreeValue+"'";&#13;&#10;		 var id=window.selTree_tree.getSelectedItemId();&#13;&#10;		 var org_code=window.selTree_tree.getUserData(id,'org_code');&#13;&#10;		if(org_code)&#13;&#10;		{&#13;&#10;		 sql+=" and b.dep_code like '"+org_code+"%' ";&#13;&#10;		}&#13;&#10;		setDsSql('ds1', sql);&#13;&#10;		refreshDsById('ds1');&#13;&#10;	}&#13;&#10;    &#13;&#10;	&#13;&#10;}&#13;&#10;&#13;&#10;function load()&#13;&#10;{&#13;&#10;  &#13;&#10;   //var notSelect= $urlParam('notSelect');&#13;&#10;var notSelect=0;&#13;&#10;   var ds1=getDs('ds1');&#13;&#10;   var count = ds1.dataCount();&#13;&#10;   if(count>=1) //已设置&#13;&#10;   {&#13;&#10;     notSelect=1;&#13;&#10;   }&#13;&#10;&#13;&#10;	&#13;&#10;    var orgTree=window.selTree_tree;&#13;&#10;    var orgId= $urlParam('orgId');&#13;&#10;   var roleId= $urlParam('roleId');&#13;&#10;&#13;&#10;&#13;&#10;    //var id="906e63a30e6f45feb953f14a1ea170a9";&#13;&#10;   // var roleId="18899a95707a429a8189a0fe1df33d8a";&#13;&#10;    if(orgId)&#13;&#10;    {&#13;&#10;       orgTree.selectItem(orgId);&#13;&#10;       var name=orgTree.getAttribute(orgId,"text");&#13;&#10;       $('#selTxt_tree').text(name);&#13;&#10;      &#13;&#10;    }&#13;&#10;    if(roleId)&#13;&#10;    {&#13;&#10;        $('#sel_roleTree').val(roleId);&#13;&#10;    }&#13;&#10;    if(notSelect==1) //不能选择的&#13;&#10;    {&#13;&#10;      $('#sel_roleTree').attr('disabled','disabled');&#13;&#10;	  $('#sel_tree').attr('disabled','disabled');&#13;&#10;	  $('#sel_btn_tree').unbind( "click" );&#13;&#10;	 &#13;&#10;&#13;&#10;   }&#13;&#10;&#13;&#10;     orgTree.insertNewChild("B00001"  ,"allid","所有组织",0);&#13;&#10;    if(count<1)&#13;&#10;    {&#13;&#10;      changeOrgRole()&#13;&#10;     }&#13;&#10;&#13;&#10;    $('#grid_grid1 .hdrcell:first').append('<input style="margin-top:10px;margin-left:-15px;width:16px;height:16px;" type="checkbox"  class="check_all" id="checkAll" onclick="selectAllCheck(this)">');&#13;&#10;   var grid=getGrid('grid1');&#13;&#10;   grid.enableStableSorting(true);&#13;&#10;	grid.attachEvent("onRowDblClicked", function(rId,cInd){&#13;&#10;	  addItemCommon(rId);&#13;&#10;	});  &#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;function addItemCommon(id){&#13;&#10;	var grid=getGrid('grid1');&#13;&#10;	var checkedID="";&#13;&#10;	if(id){&#13;&#10;	checkedID=id+"";&#13;&#10;	}else{&#13;&#10;	checkedID=grid.getCheckedRows(0);&#13;&#10;	}&#13;&#10;	&#13;&#10;	var ds=getDs('ds1');&#13;&#10;	var sel=$('#userSel');&#13;&#10;	if(checkedID.length>0){&#13;&#10;		checkedID=checkedID.split(',');&#13;&#10;		for (var i = 0; i < checkedID.length; i++) {&#13;&#10;			var id = checkedID[i];&#13;&#10;			var thisItem=ds.item(id);&#13;&#10;			$('#user_'+thisItem.account_name).remove();&#13;&#10;			sel.append('<option id="user_'+thisItem.account_name+'" value="'+thisItem.account_name+'">'+thisItem.user_name+'</option>');&#13;&#10;&#13;&#10;		}&#13;&#10;	}else{&#13;&#10;		$.dialog.tips('请至少选上一人!',2);&#13;&#10;	}&#13;&#10;&#13;&#10;}&#13;&#10;function delItemCommon(){&#13;&#10;	$("#userSel option:selected").remove();&#13;&#10;}&#13;&#10;&#13;&#10;function btn_ok(){&#13;&#10;	var userId=[];&#13;&#10;	var userName=[];&#13;&#10;	$("#userSel option").each(function(){&#13;&#10;		userId.push($(this).val());&#13;&#10;		userName.push($(this).text());&#13;&#10;	});&#13;&#10;	try{&#13;&#10;		window.edenCallBack(userId,userName);&#13;&#10;	}catch (e){&#13;&#10;&#13;&#10;	}&#13;&#10;	window.parent.edenWins.window('commonSelUser').close();&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function selectAllCheck(obj){&#13;&#10;	window.event? window.event.cancelBubble = true : e.stopPropagation();&#13;&#10;	var grid=getGrid('grid1');&#13;&#10;		var ids = grid.getAllRowIds();&#13;&#10;    	//console.log(ids);&#13;&#10;    	var idsArr = ids.split(',');&#13;&#10;    	//alert(idsArr.length);&#13;&#10;    	var nowPage = grid.currentPage;&#13;&#10;    	var pageItemsLength = grid.rowsBufferOutSize;&#13;&#10;    	var allItemsLength = grid.rowsBuffer.length;&#13;&#10;    	&#13;&#10;    	var forBigen = pageItemsLength*(nowPage-1);&#13;&#10;    	var forOver = pageItemsLength*(nowPage);&#13;&#10;    	if (forOver>allItemsLength){&#13;&#10;    		forOver = allItemsLength&#13;&#10;    	}&#13;&#10;		if($(obj).is(':checked')){&#13;&#10;		 for(i=forBigen;i<forOver;i++){&#13;&#10;    		var forId = idsArr[i];&#13;&#10;    		var check = grid.cellById(forId, 0).getValue();&#13;&#10;    		grid.cellById(forId, 0).setValue(1);&#13;&#10;    	} &#13;&#10;		}else{&#13;&#10;			for(i=forBigen;i<forOver;i++){&#13;&#10;    		var forId = idsArr[i];&#13;&#10;    		var check = grid.cellById(forId, 0).getValue();&#13;&#10;    		grid.cellById(forId, 0).setValue(0);&#13;&#10;    	}&#13;&#10;		}	&#13;&#10;}&#13;&#10;</script> 
<DIV id=SKbillsheet contentEditable=true oncontrolselect=controlselect() jslib unselectable="on" contxml="<root><label><id>label2</id><id>label3</id><id>label4</id></label><listbox><id>userSel</id></listbox><button><id>button3</id><id>button4</id><id>button5</id></button><dropdownlist><id>tree</id><id>roleTree</id></dropdownlist><grid><id>grid1</id></grid><dataset><id>ds1</id></dataset></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:5;radio:0;listbox:1;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:0;button:6;text:1;hr:0;checkboxlist:0;radiolist:0;dropdownlist:1;grid:0;dataset:0;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0;editor:0" isCheckPermit="否" alertType="1" userType BLONclose BLONopenBefore BLONopen="load()" window="当前窗口" posheight poswidth postop posleft center="  " isfile="是" type="eden_form" caption="公用选择用户" dj_sn="selUser" billtaborder="<root><taborder>grid1</taborder><taborder>userSel</taborder><taborder>button3</taborder><taborder>tree</taborder><taborder>button4</taborder><taborder>button5</taborder><taborder>roleTree</taborder></root>" toolbar="不带工具栏"><IMG onmoveend=moveEnd() onresizeend=resizeEnd() onresizestart=resizeStart() id=ds1 style="HEIGHT: 32px; POSITION: absolute; LEFT: 601px; TOP: 291px; WIDTH: 32px" onmovestart=moveStart() src="../../fceform/images/ef_designer_dataset.gif" isInAddStatus="是" masterdsfield masterds subdsfield formatxml='<root><tr rowstate="add"><td>account_name</td><td>账户名</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>user_name</td><td>姓名</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' opensql="(&#13;&#10;select a.control_value account_name , ei.account_name user_name &#13;&#10; from oa_document_wf_control a &#13;&#10;inner join ea_account_info ei &#13;&#10;on a.control_value = ei.account_name&#13;&#10;&#13;&#10;where wf_name=(select name from wf_wfentry where id=':{$urlParam(&quot;wf_id&quot;)}:') and (step_id =':{$urlParam(&quot;step_id&quot;)}:' or action_id= ':{$urlParam(&quot;action_id&quot;)}:') and control_type=2 &#13;&#10;)&#13;&#10;UNION &#13;&#10;(&#13;&#10;SELECT account_name , account_name  user_name&#13;&#10;FROM  ea_account_info b &#13;&#10;WHERE  b.data_valid = 1 &#13;&#10; and EXISTS ( SELECT 1 FROM ea_account_role_relation c WHERE c.account_name = b.account_name and c.role_id in (&#13;&#10;select control_value&#13;&#10;from oa_document_wf_control&#13;&#10;where wf_name=(select name from wf_wfentry where id=':{$urlParam(&quot;wf_id&quot;)}:') and (step_id =':{$urlParam(&quot;step_id&quot;)}:' or action_id= ':{$urlParam(&quot;action_id&quot;)}:') and control_type=3 &#13;&#10;) )&#13;&#10;)" saveastable AfterScroll BeforeScroll AfterPost BeforePost BeforeOpen AfterOpen idtype="1" opensortno="1" isSubGrid="否" issubds="否" idparam savetable submitno="1" submittype="4" isaddemptyrec="否" pubpara="否" async="否" datasourceName controltype="dataset"> 
<DIV onmoveend=moveEnd() onresizeend=resizeEnd() onresizestart=resizeStart() id=grid1 class=ef_design_grid style="HEIGHT: 238px; POSITION: absolute; LEFT: 28px; TOP: 42px; WIDTH: 379px" onmovestart=moveStart() controltype="grid" showCheckbox="是" colSort="str,str" colType="ro,ro" colWidth="200,*" titlerowheight titlerows usertitlehtml usertitle iscrosstab="否" crosstabtitle crosstabsumtype="0" crosstabformat rowtitle coltitle rcount="否" rsum="否" rmin="否" rmax="否" ravg="否" ccount="否" csum="否" cmin="否" cmax="否" cavg="否" crosstabsql crosstabdatatype="0" readonly="否" bodyrowheight="-1" bodyrows="20" isPage="是" src="../images/ef_designer_webgrid.gif" visible="是" dataset="ds1"></DIV><BUTTON onmoveend=moveEnd() onmove=move() onresize=resize() onresizeend=resizeEnd() onresizestart=resizeStart() id=button3 class=ef_button style="HEIGHT: 25px; POSITION: absolute; LEFT: 310px; TOP: 314px; WIDTH: 75px" oncontrolselect=controlselect() onmovestart=moveStart() controltype="button" fc_onclick='bill_onclick("btn_ok()")'>确定</BUTTON><SELECT onmoveend=moveEnd() onmove=move() onresize=resize() onresizeend=resizeEnd() onresizestart=resizeStart() id=userSel style="HEIGHT: 220px; POSITION: absolute; LEFT: 511px; TOP: 40px; WIDTH: 140px" oncontrolselect=controlselect() onmovestart=moveStart() multiple size=8 async="否" datasourceName controltype="listbox" sql check="1" tempvalue temptext></SELECT> 
<DIV onmoveend=moveEnd() onresizeend=resizeEnd() onresizestart=resizeStart() id=tree class=ef_design_dropdownlist style="HEIGHT: 23px; POSITION: absolute; LEFT: 86px; TOP: 14px; WIDTH: 140px; ButtonWidth: 10" onmovestart=moveStart() onchange='bill_onclick("changeOrgRole()")' datasourceName controltype="dropdownlist" src="../images/ef_designer_fccode.gif" visible="是" sql="SELECT b.org_id as orgId, b.parent_id as parentId, b.org_name as orgName, b.org_code as orgCode FROM ea_org_tree b where b.data_valid=1 order by b.org_seq,b.org_code " check="2" tempvalue temptext rootNodeId="B00001" blninput="是" blnempty="否" addrow="否" multiselect="否" xml isShowTree="1" isTreeNewSql="0" FieldNameList format></DIV><LABEL onmoveend=moveEnd() onmove=move() onresize=resize() onresizeend=resizeEnd() onresizestart=resizeStart() id=label2 style="HEIGHT: 23px; FONT-FAMILY: 宋体; POSITION: absolute; FONT-WEIGHT: bold; LEFT: 31px; TOP: 14px; WIDTH: 109px" oncontrolselect=controlselect() onmovestart=moveStart() controltype="label" inputTag="否">按部门：</LABEL><BUTTON onmoveend=moveEnd() onmove=move() onresize=resize() onresizeend=resizeEnd() onresizestart=resizeStart() id=button4 class=ef_button style="HEIGHT: 25px; POSITION: absolute; LEFT: 425px; TOP: 95px; WIDTH: 75px" oncontrolselect=controlselect() onmovestart=moveStart() controltype="button" fc_onclick='bill_onclick("addItemCommon()")' CustomAttr="title=添加人员">&gt;&gt;</BUTTON><BUTTON onmoveend=moveEnd() onmove=move() onresize=resize() onresizeend=resizeEnd() onresizestart=resizeStart() id=button5 class=ef_button style="HEIGHT: 25px; POSITION: absolute; LEFT: 426px; TOP: 142px; WIDTH: 75px" oncontrolselect=controlselect() onmovestart=moveStart() controltype="button" fc_onclick='bill_onclick("delItemCommon()")' CustomAttr="title=删除人员">&lt;&lt;</BUTTON><LABEL onmoveend=moveEnd() onmove=move() onresize=resize() onresizeend=resizeEnd() onresizestart=resizeStart() id=label3 style="HEIGHT: 22px; FONT-FAMILY: 宋体; POSITION: absolute; FONT-WEIGHT: bold; LEFT: 513px; TOP: 16px; WIDTH: 128px" oncontrolselect=controlselect() onmovestart=moveStart() controltype="label" inputTag="否">已添加的人员：</LABEL><LABEL onmoveend=moveEnd() onmove=move() onresize=resize() onresizeend=resizeEnd() onresizestart=resizeStart() id=label4 style="HEIGHT: 23px; FONT-FAMILY: 宋体; POSITION: absolute; FONT-WEIGHT: bold; LEFT: 258px; TOP: 14px; WIDTH: 109px" oncontrolselect=controlselect() onmovestart=moveStart() controltype="label" inputTag="否">按角色：</LABEL> 
<DIV onmoveend=moveEnd() onresizeend=resizeEnd() onresizestart=resizeStart() id=roleTree class=ef_design_dropdownlist style="HEIGHT: 23px; POSITION: absolute; LEFT: 311px; TOP: 14px; WIDTH: 141px; ButtonWidth: 10" onmovestart=moveStart() onchange='bill_onclick("changeOrgRole()")' datasourceName controltype="dropdownlist" src="../images/ef_designer_fccode.gif" visible="是" sql="SELECT role_name,role_id&#13;&#10; FROM ea_role_info a " check="2" tempvalue temptext rootNodeId="B00001" blninput="是" blnempty="否" addrow="否" multiselect="否" xml isShowTree="0" isTreeNewSql="0" FieldNameList format></DIV></DIV><p id=splitaddhtml /><style>

</style>
