<script>function changeOrg(){&#13;&#10;	var id=window.selTree_tree.getSelectedItemId();&#13;&#10;	var org_code=window.selTree_tree.getUserData(id,'org_code');&#13;&#10;          if(!org_code)&#13;&#10;        {&#13;&#10;          org_code="";&#13;&#10;        }&#13;&#10;&#13;&#10;	var sql = "SELECT a.role_name ,a.role_id, b.org_code FROM ea_role_info a LEFT JOIN ea_org_tree b ON a.org_id = b.org_id WHERE b.org_code LIKE '"+org_code+"%' OR a.role_type = 0";&#13;&#10;	setDsSql('ds1', sql);&#13;&#10;	refreshDsById('ds1');&#13;&#10;&#13;&#10;}&#13;&#10;function addItemCommon(){&#13;&#10;	var grid=getGrid('grid1');&#13;&#10;	var checkedID=grid.getCheckedRows(0);&#13;&#10;	var ds=getDs('ds1');&#13;&#10;	var sel=$('#userSel');&#13;&#10;	if(checkedID.length>0){&#13;&#10;		checkedID=checkedID.split(',');&#13;&#10;		for (var i = 0; i < checkedID.length; i++) {&#13;&#10;			var id = checkedID[i];&#13;&#10;			var thisItem=ds.item(id);&#13;&#10;			$('#user_'+thisItem.role_id).remove();&#13;&#10;			//sel.append('<option id="user_'+thisItem.role_id+'" value="'+thisItem.role_id+'">'+thisItem.role_name+'</option>');&#13;&#10;sel.append('<li id="user_'+thisItem.role_id+'" dataname="'+thisItem.role_id+'">'+'<label><span>'+thisItem.role_name+'</span><input type="checkbox" checked="checked"></label></li>');&#13;&#10;		}&#13;&#10;	}else{&#13;&#10;		$.dialog.tips('请至少选上一个角色!',2);&#13;&#10;	}&#13;&#10;&#13;&#10;}&#13;&#10;function delItemCommon(){&#13;&#10;	//$("#userSel option:selected").remove();&#13;&#10;$("#userSel .liSelect").remove();&#13;&#10;}&#13;&#10;&#13;&#10;function btn_ok(){&#13;&#10;	var userId=[];&#13;&#10;	var userName=[];&#13;&#10;var userShow=[];&#13;&#10;	//$("#userSel option").each(function(){&#13;&#10;		//userId.push($(this).val());&#13;&#10;		//userName.push($(this).text());&#13;&#10;	//});&#13;&#10;$("#userSel li").each(function(){&#13;&#10;		userId.push($(this).attr("dataname"));&#13;&#10;		userName.push($(this).find("span").text());&#13;&#10;		var isShow=($(this).find("input").prop("checked"))?1:2;&#13;&#10;		userShow.push(isShow);&#13;&#10;	});&#13;&#10;	 var stepId = QueryURL.GetValue('step_id'); &#13;&#10;	 var actionId = QueryURL.GetValue('action_id'); &#13;&#10;     var wfName = QueryURL.GetValue('wf_name'); &#13;&#10;	 var controlType=3;&#13;&#10;	 var controlValues=userId+"";&#13;&#10;	var controlAuth=userShow+"";&#13;&#10;	  $.post(project+"/admin/documentConfig/doInsertDocumentWfControl.action", {"stepId":stepId,"actionId":actionId,"wfName":wfName,"controlType":controlType,"controlValues":controlValues,"controlAuth":controlAuth},function(result){&#13;&#10;			 if(result&&result.result=="success")&#13;&#10;			{&#13;&#10;			  alert(result.message)	&#13;&#10;			}else{&#13;&#10;			 alert("保存失败，请确保是登录状态！")	&#13;&#10;			}&#13;&#10;		   &#13;&#10;               window.close();  &#13;&#10;		});&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;function load()&#13;&#10;{&#13;&#10;    var orgTree=window.selTree_tree;&#13;&#10;orgTree.insertNewChild("B00001"  ,"allid","所有组织",0);&#13;&#10;&#13;&#10;    var sel=$('#userSel');&#13;&#10;   var ds=getDs('datasetHas');&#13;&#10;   var count = ds.dataCount();&#13;&#10;   	for (var i = 0; i < count; i++) {&#13;&#10;		var id = ds.idByIndex(i);&#13;&#10;		var dataItem=ds.item(id);&#13;&#10;		var value=dataItem.keyvalue;&#13;&#10;		var name=dataItem.name;&#13;&#10;		//sel.append('<option id="user_'+value+'" value="'+value+'">'+name+'</option>');&#13;&#10;sel.append('<li id="user_'+value+'" dataname="'+value+'">'+'<label><span>'+name+'</span><input type="checkbox" checked="checked"></label></li>');&#13;&#10;	}&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;}&#13;&#10;function selectAllCheck(obj){&#13;&#10;	window.event? window.event.cancelBubble = true : e.stopPropagation();&#13;&#10;	var grid=getGrid('grid1');&#13;&#10;		var ids = grid.getAllRowIds();&#13;&#10;    	//console.log(ids);&#13;&#10;    	var idsArr = ids.split(',');&#13;&#10;    	//alert(idsArr.length);&#13;&#10;    	var nowPage = grid.currentPage;&#13;&#10;    	var pageItemsLength = grid.rowsBufferOutSize;&#13;&#10;    	var allItemsLength = grid.rowsBuffer.length;&#13;&#10;    	&#13;&#10;    	var forBigen = pageItemsLength*(nowPage-1);&#13;&#10;    	var forOver = pageItemsLength*(nowPage);&#13;&#10;    	if (forOver>allItemsLength){&#13;&#10;    		forOver = allItemsLength&#13;&#10;    	}&#13;&#10;		if($(obj).is(':checked')){&#13;&#10;		 for(i=forBigen;i<forOver;i++){&#13;&#10;    		var forId = idsArr[i];&#13;&#10;    		var check = grid.cellById(forId, 0).getValue();&#13;&#10;    		grid.cellById(forId, 0).setValue(1);&#13;&#10;    	} &#13;&#10;		}else{&#13;&#10;			for(i=forBigen;i<forOver;i++){&#13;&#10;    		var forId = idsArr[i];&#13;&#10;    		var check = grid.cellById(forId, 0).getValue();&#13;&#10;    		grid.cellById(forId, 0).setValue(0);&#13;&#10;    	}&#13;&#10;		}	&#13;&#10;}&#13;&#10;&#13;&#10;$(function(){&#13;&#10;	$(document).on("click","#userSel li",function(){&#13;&#10;		$(this).toggleClass('liSelect');&#13;&#10;	});&#13;&#10;});</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true jslib BLONclose BLONopen="load()" center="  " unselectable="on" toolbar="不带工具栏" dj_sn="selRoleControl" type="eden_form" caption="公用选择用户" window="当前窗口" posleft postop poswidth posheight isfile="是" billtaborder="<root><taborder>grid1</taborder><taborder>userSel</taborder><taborder>button3</taborder><taborder>tree</taborder><taborder>button4</taborder><taborder>button5</taborder></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:3;radio:0;listbox:1;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:0;button:5;text:1;hr:0;checkboxlist:0;radiolist:0;dropdownlist:1;grid:0;dataset:1;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0;editor:0" contxml="<root><label><id>label2</id><id>label3</id></label><listbox><id>userSel</id></listbox><button><id>button3</id><id>button4</id><id>button5</id></button><dropdownlist><id>tree</id></dropdownlist><grid><id>grid1</id></grid><dataset><id>ds1</id><id>datasetHas</id></dataset></root>" BLONopenBefore userType isCheckPermit="否" alertType="1"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 32px; HEIGHT: 32px; TOP: 241px; LEFT: 756px" id=ds1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" idtype="1" async="否" datasourceName masterdsfield masterds subdsfield issubds="否" idparam savetable submitno="1" submittype="4" isaddemptyrec="否" isSubGrid="否" saveastable formatxml='<root><tr rowstate="add"><td>role_name</td><td>角色名</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>role_id</td><td>角色ID</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' pubpara="否" opensql="SELECT&#13;&#10;&#9;a.role_name ,a.role_id, b.org_code&#13;&#10;FROM&#13;&#10;&#9;ea_role_info a&#13;&#10;LEFT JOIN ea_org_tree b ON a.org_id = b.org_id" AfterScroll BeforeScroll AfterPost BeforePost BeforeOpen AfterOpen opensortno="1" controltype="dataset"> 
<DIV onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 379px; HEIGHT: 238px; TOP: 42px; LEFT: 28px" id=grid1 class=ef_design_grid onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="grid" src="../images/ef_designer_webgrid.gif" crosstabdatatype="0" crosstabsql cavg="否" cmax="否" cmin="否" csum="否" ccount="否" ravg="否" rmax="否" rmin="否" rsum="否" rcount="否" coltitle rowtitle crosstabformat crosstabsumtype="0" crosstabtitle iscrosstab="否" bodyrows="10" showCheckbox="是" colSort="str,str" colType="ro,ro" colWidth="100,*" bodyrowheight="-1" isPage="是" readonly="否" visible="是" usertitle usertitlehtml titlerows titlerowheight dataset="ds1"></DIV><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 314px; LEFT: 310px" id=button3 onresize=resize() onmove=move() class=ef_button onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("btn_ok()")'>确定</BUTTON> 
<UL onresizeend=resizeEnd() oncontrolselect=controlselect() style="BORDER-BOTTOM: grey 1px inset; POSITION: absolute; BORDER-LEFT: grey 1px inset; WIDTH: 140px; HEIGHT: 220px; BORDER-TOP: grey 1px inset; TOP: 40px; BORDER-RIGHT: grey 1px inset; LEFT: 511px" id=userSel onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() async="否" datasourceName controltype="listbox" temptext tempvalue check="1" sql multiple size="8"></UL>
<DIV onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 185px; HEIGHT: 23px; TOP: 12px; LEFT: 144px; ButtonWidth: 10" id=tree class=ef_design_dropdownlist onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() onchange='bill_onclick("changeOrg()")' datasourceName controltype="dropdownlist" src="../images/ef_designer_fccode.gif" visible="是" temptext tempvalue check="2" sql='SELECT b.org_id , b.parent_id , b.org_name "org_name", b.org_code "org_code" FROM ea_org_tree b where b.data_valid=1 order by b.org_seq,b.org_code ' rootNodeId="B00001" FieldNameList isTreeNewSql="0" isShowTree="1" multiselect="否" addrow="否" blnempty="否" blninput="是" format xml></DIV><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 109px; FONT-FAMILY: 宋体; HEIGHT: 23px; TOP: 16px; FONT-WEIGHT: bold; LEFT: 33px" id=label2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">按所在部门查询：</LABEL><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 95px; LEFT: 425px" id=button4 onresize=resize() onmove=move() class=ef_button onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("addItemCommon()")' CustomAttr="title=添加人员">&gt;&gt;</BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 142px; LEFT: 426px" id=button5 onresize=resize() onmove=move() class=ef_button onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("delItemCommon()")' CustomAttr="title=删除人员">&lt;&lt;</BUTTON><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 128px; FONT-FAMILY: 宋体; HEIGHT: 22px; TOP: 16px; FONT-WEIGHT: bold; LEFT: 513px" id=label3 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">已添加的角色：</LABEL><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 32px; HEIGHT: 32px; TOP: 341px; LEFT: 701px" id=datasetHas onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" idtype="1" async="否" datasourceName masterdsfield masterds subdsfield issubds="否" idparam savetable submitno="1" submittype="4" isaddemptyrec="否" isSubGrid="否" saveastable formatxml='<root><tr rowstate="add"><td>keyvalue</td><td>keyvalue</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>name</td><td>name</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' pubpara="否" opensql="select ei.role_id keyvalue , ei.role_name name&#13;&#10; from oa_document_wf_control a &#13;&#10;inner join ea_role_info  ei &#13;&#10;on a.control_value = ei.role_id&#13;&#10;where wf_name=':{$urlParam(&quot;wf_name&quot;)}:' and step_id =':{$urlParam(&quot;step_id&quot;)}:' and control_type=3" AfterScroll BeforeScroll AfterPost BeforePost BeforeOpen AfterOpen opensortno="1" controltype="dataset" isInAddStatus="是"></DIV><p id=splitaddhtml /><style>
.liSelect {
    background-color: blue;
}
</style>
