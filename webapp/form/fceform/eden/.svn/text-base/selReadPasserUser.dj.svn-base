<script>&#13;&#10;&#13;&#10;var isAddUser=$urlParam('isAddUser');  //是否是增加传阅人&#13;&#10;&#13;&#10;function load()&#13;&#10;{&#13;&#10;   var mainDataset=window.data_readpassdb; &#13;&#10;   var dataItem=mainDataset.item(mainDataset.idByIndex(0));&#13;&#10;  &#13;&#10;   var isPassing=0; //是否正在传阅&#13;&#10;     if(dataItem)&#13;&#10;    {&#13;&#10;        if(dataItem.data_valid==1)&#13;&#10;        {&#13;&#10;           if(!isAddUser)&#13;&#10;           {&#13;&#10;		       $.dialog.alert('此公文已开启传阅,请先停止传阅或添加传阅人！');&#13;&#10;		   &#13;&#10;               setTimeout(function(){&#13;&#10;&#13;&#10;				 try {&#13;&#10;                       window.edenCallBack(); &#13;&#10;                    } catch (e) {&#13;&#10;&#13;&#10;					}  &#13;&#10;				},2000);&#13;&#10;&#13;&#10;           }&#13;&#10;           &#13;&#10;            isPassing=1;&#13;&#10;        }&#13;&#10;	&#13;&#10;    }&#13;&#10;    if(isAddUser&&isPassing==0)&#13;&#10;    {&#13;&#10;        $.dialog.alert('当前未在传阅！');&#13;&#10;       &#13;&#10;&#13;&#10;         setTimeout(function(){&#13;&#10;&#13;&#10;				 try {&#13;&#10;                       window.edenCallBack(); &#13;&#10;                    } catch (e) {&#13;&#10;&#13;&#10;				}  &#13;&#10;		},2000);&#13;&#10;     }&#13;&#10;	 &#13;&#10;	 var orgId= $urlParam('orgId');&#13;&#10;	 var notSelect= $urlParam('notSelect');&#13;&#10;	 var orgTree=window.selTree_tree;&#13;&#10;	 if(orgId)&#13;&#10;    {&#13;&#10;       orgTree.selectItem(orgId);&#13;&#10;       var name=orgTree.getAttribute(orgId,"text");&#13;&#10;       $('#selTxt_tree').text(name);&#13;&#10;      &#13;&#10;    }&#13;&#10;	if(notSelect==1) //不能选择的&#13;&#10;    {&#13;&#10;	  $('#sel_tree').attr('disabled','disabled');&#13;&#10;	  $('#sel_btn_tree').unbind( "click" );&#13;&#10;	 &#13;&#10;&#13;&#10;   }&#13;&#10;   changeOrg()&#13;&#10;	 $('#grid_grid1 .hdrcell:first').append('<input style="margin-left:-15px;width:16px;height:16px;" type="checkbox"  class="check_all" id="checkAll" onclick="selectAllCheck(this)">');&#13;&#10;	var grid=getGrid('grid1');&#13;&#10;	grid.enableStableSorting(true);&#13;&#10;	grid.attachEvent("onRowDblClicked", function(rId,cInd){&#13;&#10;	  addItemCommon(rId);&#13;&#10;	});  &#13;&#10; &#13;&#10;}&#13;&#10;function changeOrg(){&#13;&#10;	var id=window.selTree_tree.getSelectedItemId();&#13;&#10;	var org_code=window.selTree_tree.getUserData(id,'org_code');&#13;&#10;	if(!org_code)&#13;&#10;	{&#13;&#10;	  org_code="";&#13;&#10;	}&#13;&#10;	var sql = "SELECT a.account_name, b.user_name FROM ea_account_info a LEFT JOIN ea_user_info b ON a.user_id = b.user_id WHERE a.dep_code LIKE '"+org_code+"%'";&#13;&#10;	setDsSql('ds1', sql);&#13;&#10;	refreshDsById('ds1');&#13;&#10;&#13;&#10;}&#13;&#10;function addItemCommon(id){&#13;&#10;	var grid=getGrid('grid1');&#13;&#10;	var checkedID;&#13;&#10;	if(id){&#13;&#10;	checkedID=id+"";&#13;&#10;	}else{&#13;&#10;	checkedID=grid.getCheckedRows(0);&#13;&#10;	}&#13;&#10;	var ds=getDs('ds1');&#13;&#10;	var sel=$('#userSel');&#13;&#10;	if(checkedID.length>0){&#13;&#10;		checkedID=checkedID.split(',');&#13;&#10;		for (var i = 0; i < checkedID.length; i++) {&#13;&#10;			var id = checkedID[i];&#13;&#10;			var thisItem=ds.item(id);&#13;&#10;			$('#user_'+thisItem.account_name).remove();&#13;&#10;			sel.append('<option id="user_'+thisItem.account_name+'" value="'+thisItem.account_name+'">'+thisItem.user_name+'</option>');&#13;&#10;&#13;&#10;		}&#13;&#10;	}else{&#13;&#10;		$.dialog.tips('请至少选上一人!',2);&#13;&#10;	}&#13;&#10;&#13;&#10;}&#13;&#10;function delItemCommon(){&#13;&#10;	$("#userSel option:selected").remove();&#13;&#10;}&#13;&#10;&#13;&#10;function btn_ok(){&#13;&#10;	var userId=[];&#13;&#10;	var userName=[];&#13;&#10;	$("#userSel option").each(function(){&#13;&#10;		userId.push($(this).val());&#13;&#10;		userName.push($(this).text());&#13;&#10;	});&#13;&#10;	&#13;&#10;	if(isAddUser)  //增加传阅人时&#13;&#10;	{&#13;&#10;		&#13;&#10;		var newpassers=$('#text2').val(); &#13;&#10;	   &#13;&#10;		for(var i=0;i<userId.length;i++)&#13;&#10;		{&#13;&#10;		  &#13;&#10;			if(userId[i])&#13;&#10;			{&#13;&#10;				newpassers=addPasser(userId[i],newpassers);&#13;&#10;			}&#13;&#10;		&#13;&#10;		}&#13;&#10;		userId=newpassers;&#13;&#10;		$('#text2').val(userId);&#13;&#10;		doSub();&#13;&#10;		&#13;&#10;	}else{  //开启传阅时&#13;&#10;	   var title=$urlParam('title');&#13;&#10;	  title=decodeURI(title);&#13;&#10;	  $('#titleId').val(title)&#13;&#10;&#13;&#10;	  //设置可传阅&#13;&#10;	  $('#dataValidId').val(1);&#13;&#10;		$('#text2').val(userId);&#13;&#10;		&#13;&#10;		var wfId=$urlParam('wfId');&#13;&#10;		var getShowUrlAction=project+"/admin/documentwf/getShowUrlByWfid.action?wfId="+wfId;&#13;&#10;	  	$.post(getShowUrlAction,"",function(result){&#13;&#10;	          if(result)&#13;&#10;			  {&#13;&#10;			     var showPassSendUrl=result.showUrl;&#13;&#10;				 if(showPassSendUrl)&#13;&#10;				 {&#13;&#10;					//  var showPassSendUrl=$urlParam('showPassSendUrl');&#13;&#10;					showPassSendUrl=showPassSendUrl+"&pass=1";&#13;&#10;					showPassSendUrl=decodeURIComponent(showPassSendUrl);&#13;&#10;						$('#showUrlId').val(showPassSendUrl)&#13;&#10;				       doSub();&#13;&#10;				 }else{&#13;&#10;				   $.dialog.tips("提交失败!");&#13;&#10;				 }&#13;&#10;			  }&#13;&#10;		});&#13;&#10;	}&#13;&#10;&#13;&#10;	&#13;&#10;&#13;&#10;	&#13;&#10;	&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function doSub()&#13;&#10;{&#13;&#10;	doSubmitData(function () {&#13;&#10;		$.dialog.tips("传阅成功!");&#13;&#10;		  &#13;&#10;		 window.setTimeout(function () {&#13;&#10;						try {&#13;&#10;						   window.edenCallBack(); &#13;&#10;						} catch (e) {&#13;&#10;&#13;&#10;						}&#13;&#10;		   }, 300);&#13;&#10;	  &#13;&#10;&#13;&#10;   });&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;//添加传阅人&#13;&#10;function addPasser(addpasser,signs)&#13;&#10;{&#13;&#10;&#13;&#10;	var returnSign="";&#13;&#10;	     if(signs)&#13;&#10;	     {&#13;&#10;			 var hasName=0;  //是否已经包含了&#13;&#10;			 var valspl=signs.split(",");  //排重&#13;&#10;			 for(var i=0;i<valspl.length;i++)&#13;&#10;			{&#13;&#10;				&#13;&#10;				 if(addpasser==valspl[i])&#13;&#10;			     {&#13;&#10;					 hasName=1; //有了该阅者 &#13;&#10;					 &#13;&#10;			     }&#13;&#10;				 &#13;&#10;			}&#13;&#10;			 if(hasName==0) //加入阅者&#13;&#10;		     {&#13;&#10;				 signs+=","+addpasser;&#13;&#10;		     }&#13;&#10;			 returnSign=signs;&#13;&#10;			 &#13;&#10;	     }else{  //前面没有阅者&#13;&#10;	    	 &#13;&#10;	    	 &#13;&#10;	    	 returnSign=addpasser;&#13;&#10;	     }&#13;&#10;	&#13;&#10;	return returnSign;&#13;&#10;}&#13;&#10;function selectAllCheck(obj){&#13;&#10;	window.event? window.event.cancelBubble = true : e.stopPropagation();&#13;&#10;	var grid=getGrid('grid1');&#13;&#10;		var ids = grid.getAllRowIds();&#13;&#10;    	//console.log(ids);&#13;&#10;    	var idsArr = ids.split(',');&#13;&#10;    	//alert(idsArr.length);&#13;&#10;    	var nowPage = grid.currentPage;&#13;&#10;    	var pageItemsLength = grid.rowsBufferOutSize;&#13;&#10;    	var allItemsLength = grid.rowsBuffer.length;&#13;&#10;    	&#13;&#10;    	var forBigen = pageItemsLength*(nowPage-1);&#13;&#10;    	var forOver = pageItemsLength*(nowPage);&#13;&#10;    	if (forOver>allItemsLength){&#13;&#10;    		forOver = allItemsLength&#13;&#10;    	}&#13;&#10;		if($(obj).is(':checked')){&#13;&#10;		 for(i=forBigen;i<forOver;i++){&#13;&#10;    		var forId = idsArr[i];&#13;&#10;    		var check = grid.cellById(forId, 0).getValue();&#13;&#10;    		grid.cellById(forId, 0).setValue(1);&#13;&#10;    	} &#13;&#10;		}else{&#13;&#10;			for(i=forBigen;i<forOver;i++){&#13;&#10;    		var forId = idsArr[i];&#13;&#10;    		var check = grid.cellById(forId, 0).getValue();&#13;&#10;    		grid.cellById(forId, 0).setValue(0);&#13;&#10;    	}&#13;&#10;		}	&#13;&#10;}&#13;&#10;</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true jslib userType BLONopenBefore BLONclose center="  " BLONopen="load()" unselectable="on" toolbar="不带工具栏" dj_sn="selReadPasserUser" type="eden_form" caption="选择传阅用户" window="当前窗口" posleft postop poswidth posheight isfile="是" billtaborder="<root><taborder>grid1</taborder><taborder>userSel</taborder><taborder>button3</taborder><taborder>tree</taborder><taborder>button4</taborder><taborder>button5</taborder><taborder>text2</taborder><taborder>titleId</taborder><taborder>showUrlId</taborder><taborder>dataValidId</taborder></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:3;radio:0;listbox:1;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:0;button:5;text:5;hr:0;checkboxlist:0;radiolist:0;dropdownlist:1;grid:0;dataset:1;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0;editor:0" contxml="<root><label><id>label2</id><id>label3</id></label><listbox><id>userSel</id></listbox><button><id>button3</id><id>button4</id><id>button5</id></button><text><id>text2</id><id>titleId</id><id>showUrlId</id><id>dataValidId</id></text><dropdownlist><id>tree</id></dropdownlist><grid><id>grid1</id></grid><dataset><id>ds1</id><id>readpassdb</id></dataset></root>" alertType="1" isCheckPermit="否"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 32px; HEIGHT: 32px; TOP: 308px; LEFT: 466px" id=ds1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" controltype="dataset" datasourceName idtype="1" opensortno="1" masterdsfield masterds subdsfield issubds="否" idparam savetable submitno="1" submittype="4" isaddemptyrec="否" formatxml='<root><tr rowstate="add"><td>account_name</td><td>账户名</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>user_name</td><td>姓名</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' pubpara="否" opensql="SELECT&#13;&#10;&#9;a.account_name,&#13;&#10;&#9;b.user_name&#13;&#10;FROM&#13;&#10;&#9;ea_account_info a&#13;&#10;LEFT JOIN ea_user_info b ON a.user_id = b.user_id" AfterScroll BeforeScroll AfterPost BeforePost BeforeOpen AfterOpen saveastable isSubGrid="否" async="否"> 
<DIV onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 379px; HEIGHT: 238px; TOP: 42px; LEFT: 28px" id=grid1 class=ef_design_grid onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() dataset="ds1" controltype="grid" src="../images/ef_designer_webgrid.gif" visible="是" bodyrowheight="-1" bodyrows="20" readonly="否" usertitle titlerowheight titlerows usertitlehtml iscrosstab="否" rcount="否" rsum="否" rmin="否" rmax="否" ravg="否" ccount="否" csum="否" cmin="否" cmax="否" cavg="否" rowtitle coltitle crosstabdatatype="0" crosstabsumtype="0" crosstabformat crosstabsql crosstabtitle showCheckbox="是" colSort="str,str" colType="ro,ro" colWidth="200,*" isPage="是"></DIV><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 314px; LEFT: 310px" id=button3 onresize=resize() onmove=move() class=ef_button onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("btn_ok()")'>确定</BUTTON><SELECT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 140px; HEIGHT: 220px; TOP: 40px; LEFT: 511px" id=userSel onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() multiple size=8 controltype="listbox" datasourceName async="否" temptext tempvalue check="1" sql></SELECT> 
<DIV onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 185px; HEIGHT: 23px; TOP: 12px; LEFT: 144px; ButtonWidth: 10" id=tree class=ef_design_dropdownlist onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() onchange='bill_onclick("changeOrg()")' controltype="dropdownlist" datasourceName format FieldNameList isTreeNewSql="0" isShowTree="1" xml multiselect="否" addrow="否" blnempty="否" blninput="是" rootNodeId="B00001" temptext tempvalue check="2" sql="select org_id , parent_id , org_name , org_code from ea_org_tree order by org_seq,org_code" src="../images/ef_designer_fccode.gif" visible="是"></DIV><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 109px; FONT-FAMILY: 宋体; HEIGHT: 23px; TOP: 16px; FONT-WEIGHT: bold; LEFT: 33px" id=label2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">按所在部门查询：</LABEL><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 95px; LEFT: 425px" id=button4 onresize=resize() onmove=move() class=ef_button onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("addItemCommon()")' CustomAttr="title=添加人员">&gt;&gt;</BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 142px; LEFT: 426px" id=button5 onresize=resize() onmove=move() class=ef_button onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("delItemCommon()")' CustomAttr="title=删除人员">&lt;&lt;</BUTTON><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 128px; FONT-FAMILY: 宋体; HEIGHT: 22px; TOP: 16px; FONT-WEIGHT: bold; LEFT: 513px" id=label3 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">已添加的人员：</LABEL><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 32px; HEIGHT: 32px; TOP: 328px; LEFT: 627px" id=readpassdb onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" controltype="dataset" datasourceName idtype="8" opensortno="1" masterdsfield masterds subdsfield issubds="否" idparam="BBB" savetable="oa_document_readpass" submitno="1" submittype="1" isaddemptyrec="否" formatxml="<root><tr rowstate=&quot;add&quot;><td>id</td><td>id</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>title</td><td>title</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>wf_id</td><td>流程id</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td>$urlParam('wfId')</td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>dtype</td><td>类型：如正式文</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td>$urlParam('dtype')</td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>readers</td><td>传阅的人</td><td>字符</td><td>500</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>是</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>show_url</td><td>show_url</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td>$urlParam('showPassSendUrl')</td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>data_valid</td><td>data_valid</td><td>整数</td><td>10</td><td>0</td><td>数据项</td><td>1</td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>create_dttm</td><td>创建时间</td><td>时间</td><td>19</td><td>0</td><td>数据项</td><td>GetTime()</td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>" pubpara="否" opensql="select * from oa_document_readpass &#13;&#10;where wf_id=':{$urlParam(&quot;wfId&quot;)}:' and data_valid=1" AfterScroll BeforeScroll AfterPost BeforePost BeforeOpen AfterOpen saveastable isSubGrid="否" isInAddStatus="是" async="否"><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 110px; DISPLAY: none; HEIGHT: 20px; TOP: 352px; LEFT: 176px" id=text2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() value=传阅的人 china="传阅的人" field="readers" dataset="readpassdb" controltype="text"><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 110px; DISPLAY: none; HEIGHT: 20px; TOP: 317px; LEFT: 132px" id=titleId onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() value=title china="title" field="title" dataset="readpassdb" controltype="text"><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 110px; DISPLAY: none; HEIGHT: 20px; TOP: 379px; LEFT: 68px" id=showUrlId onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() value=show_url china="show_url" field="show_url" dataset="readpassdb" controltype="text"><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 110px; DISPLAY: none; HEIGHT: 20px; TOP: 397px; LEFT: 351px" id=dataValidId onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() value=data_valid china="data_valid" field="data_valid" dataset="readpassdb" controltype="text"></DIV><p id=splitaddhtml /><style>

</style>
