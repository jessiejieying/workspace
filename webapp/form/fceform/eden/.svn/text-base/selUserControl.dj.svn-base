<script>function changeOrg(){&#13;&#10;      var step_id = QueryURL.GetValue('step_id'); &#13;&#10;     var wf_name = QueryURL.GetValue('wf_name'); &#13;&#10;	var id=window.selTree_tree.getSelectedItemId();&#13;&#10;	var org_code=window.selTree_tree.getUserData(id,'org_code');&#13;&#10;	var sql = "SELECT a.account_name, b.user_name FROM ea_account_info a LEFT JOIN ea_user_info b ON a.user_id = b.user_id WHERE a.dep_code LIKE '"+org_code+"%'  ";&#13;&#10;	setDsSql('ds1', sql);&#13;&#10;	refreshDsById('ds1');&#13;&#10;&#13;&#10;}&#13;&#10;function addItemCommon(id){&#13;&#10;	var grid=getGrid('grid1');&#13;&#10;var checkedID="";&#13;&#10;      if(id){&#13;&#10;	checkedID=id+"";&#13;&#10;	}else{&#13;&#10;	checkedID=grid.getCheckedRows(0);&#13;&#10;	}&#13;&#10;&#13;&#10;		var ds=getDs('ds1');&#13;&#10;	var sel=$('#userSel');&#13;&#10;	if(checkedID.length>0){&#13;&#10;		checkedID=checkedID.split(',');&#13;&#10;		for (var i = 0; i < checkedID.length; i++) {&#13;&#10;			var id = checkedID[i];&#13;&#10;			var thisItem=ds.item(id);&#13;&#10;			$('#user_'+thisItem.account_name).remove();&#13;&#10;			sel.append('<li id="user_'+thisItem.account_name+'" dataname="'+thisItem.account_name+'">'+'<label><span>'+thisItem.user_name+'</span><input type="checkbox" checked="checked"></label></li>');&#13;&#10;&#13;&#10;		}&#13;&#10;	}else{&#13;&#10;		$.dialog.tips('请至少选上一人!',2);&#13;&#10;	}&#13;&#10;&#13;&#10;}&#13;&#10;function delItemCommon(){&#13;&#10;	$("#userSel .liSelect").remove();&#13;&#10;}&#13;&#10;&#13;&#10;function btn_ok(){&#13;&#10;	var userId=[];&#13;&#10;	var userName=[];&#13;&#10;	var userShow=[];&#13;&#10;	$("#userSel li").each(function(){&#13;&#10;		userId.push($(this).attr("dataname"));&#13;&#10;		userName.push($(this).find("span").text());&#13;&#10;		var isShow=($(this).find("input").prop("checked"))?1:2;&#13;&#10;		userShow.push(isShow);&#13;&#10;	});&#13;&#10;	 var stepId = QueryURL.GetValue('step_id'); &#13;&#10; var actionId = QueryURL.GetValue('action_id'); &#13;&#10;     var wfName = QueryURL.GetValue('wf_name'); &#13;&#10;	 var controlType=2;&#13;&#10;	 var controlValues=userId+"";&#13;&#10;	 var controlAuth=userShow+"";&#13;&#10;	  $.post(project+"/admin/documentConfig/doInsertDocumentWfControl.action", {"stepId":stepId,"actionId":actionId,"wfName":wfName,"controlType":controlType,"controlValues":controlValues,"controlAuth":controlAuth},function(result){&#13;&#10;            if(result&&result.result=="success")&#13;&#10;			{&#13;&#10;			  alert(result.message)	&#13;&#10;			}else{&#13;&#10;			 alert("保存失败，请确保是登录状态！")	&#13;&#10;			}&#13;&#10;		   &#13;&#10;             window.close();       &#13;&#10;  &#13;&#10;		});&#13;&#10;	//window.parent.edenWins.window('commonSelUser').close();&#13;&#10;    &#13;&#10;}&#13;&#10;&#13;&#10;function load()&#13;&#10;{&#13;&#10;   var sel=$('#userSel');&#13;&#10;   var ds=getDs('datasetHas');&#13;&#10;   var count = ds.dataCount();&#13;&#10;   	for (var i = 0; i < count; i++) {&#13;&#10;		var id = ds.idByIndex(i);&#13;&#10;		var dataItem=ds.item(id);&#13;&#10;		var accountName=dataItem.userId;&#13;&#10;		var userName=dataItem.userName;&#13;&#10;&#13;&#10;sel.append('<li id="user_'+accountName+'" dataname="'+accountName+'">'+'<label><span>'+userName+'</span><input type="checkbox" checked="checked"></label></li>');&#13;&#10;&#13;&#10;&#13;&#10;	}&#13;&#10; &#13;&#10;   $('#grid_grid1 .hdrcell:first').append('<input style="margin-left:-15px;margin-top:10px;width:16px;height:16px;" type="checkbox"  class="check_all" id="checkAll" onclick="selectAllCheck(this)">');&#13;&#10;   var grid=getGrid('grid1');&#13;&#10;   grid.enableStableSorting(true);&#13;&#10;	grid.attachEvent("onRowDblClicked", function(rId,cInd){&#13;&#10;	  addItemCommon(rId);&#13;&#10;	});  &#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function selectAllCheck(obj){&#13;&#10;	window.event? window.event.cancelBubble = true : e.stopPropagation();&#13;&#10;	var grid=getGrid('grid1');&#13;&#10;		var ids = grid.getAllRowIds();&#13;&#10;    	//console.log(ids);&#13;&#10;    	var idsArr = ids.split(',');&#13;&#10;    	//alert(idsArr.length);&#13;&#10;    	var nowPage = grid.currentPage;&#13;&#10;    	var pageItemsLength = grid.rowsBufferOutSize;&#13;&#10;    	var allItemsLength = grid.rowsBuffer.length;&#13;&#10;    	&#13;&#10;    	var forBigen = pageItemsLength*(nowPage-1);&#13;&#10;    	var forOver = pageItemsLength*(nowPage);&#13;&#10;    	if (forOver>allItemsLength){&#13;&#10;    		forOver = allItemsLength&#13;&#10;    	}&#13;&#10;		if($(obj).is(':checked')){&#13;&#10;		 for(i=forBigen;i<forOver;i++){&#13;&#10;    		var forId = idsArr[i];&#13;&#10;    		var check = grid.cellById(forId, 0).getValue();&#13;&#10;    		grid.cellById(forId, 0).setValue(1);&#13;&#10;    	} &#13;&#10;		}else{&#13;&#10;			for(i=forBigen;i<forOver;i++){&#13;&#10;    		var forId = idsArr[i];&#13;&#10;    		var check = grid.cellById(forId, 0).getValue();&#13;&#10;    		grid.cellById(forId, 0).setValue(0);&#13;&#10;    	}&#13;&#10;		}	&#13;&#10;}&#13;&#10;&#13;&#10;$(function(){&#13;&#10;	$(document).on("click","#userSel li",function(){&#13;&#10;		$(this).toggleClass('liSelect');&#13;&#10;	});&#13;&#10;});</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true jslib toolbar="不带工具栏" billtaborder="<root><taborder>grid1</taborder><taborder>userSel</taborder><taborder>button3</taborder><taborder>tree</taborder><taborder>button4</taborder><taborder>button5</taborder></root>" dj_sn="selUserControl" caption="公用选择用户" type="eden_form" isfile="是" center="  " posleft postop poswidth posheight window="当前窗口" BLONopen="load()" BLONopenBefore BLONclose userType alertType="1" isCheckPermit="否" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:3;radio:0;listbox:1;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:0;button:5;text:1;hr:0;checkboxlist:0;radiolist:0;dropdownlist:1;grid:0;dataset:1;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0;editor:0" contxml="<root><label><id>label2</id><id>label3</id></label><listbox><id>userSel</id></listbox><button><id>button3</id><id>button4</id><id>button5</id></button><dropdownlist><id>tree</id></dropdownlist><grid><id>grid1</id></grid><dataset><id>ds1</id><id>datasetHas</id></dataset></root>" unselectable="on"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 32px; HEIGHT: 32px; TOP: 273px; LEFT: 717px" id=ds1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" controltype="dataset" datasourceName async="否" pubpara="否" isaddemptyrec="否" submittype="4" submitno="1" savetable idparam issubds="否" isSubGrid="否" opensortno="1" idtype="1" AfterOpen BeforeOpen BeforePost AfterPost BeforeScroll AfterScroll saveastable opensql="SELECT a.account_name, a.user_id user_name&#13;&#10; FROM ea_account_info a &#13;&#10;" formatxml='<root><tr rowstate="add"><td>account_name</td><td>账户名</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add" multisel=""><td>user_name</td><td>姓名</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' subdsfield masterds masterdsfield isInAddStatus="是"> 
<DIV onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 379px; HEIGHT: 238px; TOP: 42px; LEFT: 28px" id=grid1 class=ef_design_grid onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="grid" dataset="ds1" visible="是" src="../images/ef_designer_webgrid.gif" isPage="是" bodyrows="20" bodyrowheight="-1" readonly="否" crosstabdatatype="0" crosstabsql cavg="否" cmax="否" cmin="否" csum="否" ccount="否" ravg="否" rmax="否" rmin="否" rsum="否" rcount="否" coltitle rowtitle crosstabformat crosstabsumtype="0" crosstabtitle iscrosstab="否" usertitle usertitlehtml titlerows titlerowheight colWidth="200,*" colType="ro,ro" colSort="str,str" showCheckbox="是"></DIV><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="BACKGROUND-IMAGE: none; POSITION: absolute; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; WIDTH: 75px; PADDING-RIGHT: 0px; BACKGROUND-REPEAT: no-repeat; BACKGROUND-POSITION: 0px 0px; HEIGHT: 25px; TOP: 314px; PADDING-TOP: 0px; LEFT: 310px" id=button3 onresize=resize() onmove=move() class=ef_button onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("btn_ok()")'>保存</BUTTON> 
<UL onresizeend=resizeEnd() oncontrolselect=controlselect() style="BORDER-BOTTOM: grey 1px inset; POSITION: absolute; BORDER-LEFT: grey 1px inset; WIDTH: 140px; HEIGHT: 220px; BORDER-TOP: grey 1px inset; TOP: 40px; BORDER-RIGHT: grey 1px inset; LEFT: 511px" id=userSel onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="listbox" datasourceName async="否" temptext tempvalue check="1" sql multiple size="8"></UL>
<DIV onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 185px; HEIGHT: 23px; TOP: 12px; LEFT: 144px; ButtonWidth: 10" id=tree class=ef_design_dropdownlist onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() onchange='bill_onclick("changeOrg()")' controltype="dropdownlist" datasourceName visible="是" src="../images/ef_designer_fccode.gif" temptext tempvalue check="2" sql='select org_id , parent_id , org_name "org_name", org_code "org_code" from ea_org_tree &#13;&#10;where&#13;&#10;data_valid=1 order by org_seq,org_code ' format FieldNameList isTreeNewSql="0" isShowTree="1" xml multiselect="否" addrow="否" blnempty="否" blninput="是" rootNodeId="B00001"></DIV><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 109px; FONT-FAMILY: 宋体; HEIGHT: 23px; TOP: 16px; FONT-WEIGHT: bold; LEFT: 33px" id=label2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">按所在部门查询：</LABEL><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 95px; LEFT: 425px" id=button4 onresize=resize() onmove=move() class=ef_button onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("addItemCommon()")' CustomAttr="title=添加人员">&gt;&gt;</BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 142px; LEFT: 426px" id=button5 onresize=resize() onmove=move() class=ef_button onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("delItemCommon()")' CustomAttr="title=删除人员">&lt;&lt;</BUTTON><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 128px; FONT-FAMILY: 宋体; HEIGHT: 22px; TOP: 16px; FONT-WEIGHT: bold; LEFT: 513px" id=label3 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">已添加的人员：</LABEL><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 32px; HEIGHT: 32px; TOP: 353px; LEFT: 681px" id=datasetHas onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" controltype="dataset" datasourceName async="否" pubpara="否" isaddemptyrec="否" submittype="4" submitno="1" savetable idparam issubds="否" isSubGrid="否" opensortno="1" idtype="1" AfterOpen BeforeOpen BeforePost AfterPost BeforeScroll AfterScroll saveastable opensql="select a.control_value userId , ei.user_id userName&#13;&#10; from oa_document_wf_control a &#13;&#10;inner join ea_account_info ei &#13;&#10;on a.control_value = ei.account_name&#13;&#10;where wf_name=':{$urlParam(&quot;wf_name&quot;)}:' and step_id =':{$urlParam(&quot;step_id&quot;)}:' and control_type=2 " formatxml='<root><tr rowstate="add"><td>userId</td><td>userId</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>userName</td><td>userName</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' subdsfield masterds masterdsfield isInAddStatus="是"></DIV><p id=splitaddhtml /><style>
.liSelect{background-color:blue;}
</style>
