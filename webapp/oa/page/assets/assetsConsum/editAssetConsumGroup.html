<!DOCTYPE html>
<html style="overflow:hidden; height:100%;">
    <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="${base}/aufw/resources/common/css/base.css">
    <link rel="stylesheet" type="text/css" href="${base}/aufw/resources/common/artDialog/skins/default.css">
    <link rel="stylesheet" type="text/css" href="${base}/aufw/resources/common/dhtmlx/dhtmlx.css">
    <script src="${base}/aufw/resources/common/js/setskins.js"></script>
    <script>
        setSkinsCss("listCss,iconCss");
    </script>
    <link rel="stylesheet" type="text/css" href="${base}/aufw/resources/skins/freshtop/css/gice.css">
    <link rel="stylesheet" type="text/css" href="${base}/aufw/resources/common/dhtmlx/dhtmlx.css">
    <link rel="stylesheet" type="text/css" href="${base}/aufw/resources/common/artDialog/skins/default.css">
    </head>

<body style="height:100%;overflow:auto;">
	<div class="consum_wrap">
	
	<div class="clearfix consum_block">
		<div class="consum_inline clearfix"><label for="consumNo">领用编号</label><input id="consumNo" type="text" name="assetsConsum.consumNo" readonly="readonly" /></div>
			<div class="consum_inline_right clearfix"><label for="consumDate">领用时间</label><input onfocus="WdatePicker();" id="consumDate" type="text" name="consumDate" /></div>
	
	</div>
	
	<div class="clearfix consum_block">
		<div class="consum_inline clearfix"><label for="consumBy">领用人</label><input id="consumBy" type="text" name="consumBy" /></div>
		<div class="consum_inline_right clearfix"><label for="consumDep">领用人部门</label><input id="consumDep" type="text" name="consumDep" /></div>
	</div>
	
<!-- 	<div class="clearfix consum_block">
		<div class="consum_inline clearfix">
		<div class="consum_inline_right clearfix">
			<label for="consumAsset">资产</label>
				<div class="consum_inline_right clearfix"><a class="relnum_a" onclick="" href="javascript:void(0)">修改</a></div>
		
		</div>
	</div> -->
	<div class="clearfix consum_block">
		<div class="consum_inline clearfix">
		<div class="consum_inline_right clearfix">
			<label for="consumAsset">资产</label>
			<div id="gridId" style="min-width:542px;height: 150px;margin-bottom: 10px">
			</div>
		
		</div>
	</div>
	
	
	
	<div class="clearfix consum_block">
		<div class="consum_inline clearfix"><label for="remark">备注</label><textarea id="remark" name="remark"></textarea></div>
	</div>

	<div class="consum_ablock">
		<a onclick="formSubmit()" href="javascript:void(0)">修改</a><a onclick="closeWin()" href="javascript:void(0)">取消</a>
	</div>
	
	</div>
</body>
    <script src="${base}/aufw/resources/common/js/jquery.js"></script>
    <script src="${base}/aufw/resources/common/artDialog/jquery.artDialog.js"></script>
    <script src="${base}/aufw/resources/common/dhtmlx/dhtmlx.js"></script>
    <script src="${base}/aufw/resources/common/dhtmlx/dhtmlxtree_srnd.js"></script>
    <script src="${base}/aufw/resources/common/dhtmlx/dhtmlxgrid_pgn.js"></script>
    <script src="${base}/aufw/resources/common/dhtmlx/eden.js"></script>
    <script src="${base}/aufw/resources/common/js/My97DatePicker/WdatePicker.js"></script>
    <script src="${base}/form/fceform/js/MicrosoftAjax.js"></script>
    <script src="${base}/form/fceform/js/fcpub.js"></script>
    <script src="${base}/form/fceform/js/fcrundj.js"></script>
    <script src="${base}/form/fceform/js/tabpane.js"></script>
    <script src="${base}/aufw/resources/common/js/plupload/plupload.full.js"></script>
    <script src="${base}/form/resources/common/js/temp.js"></script>
<script>
   var grid;
   
   

  
	function init() { 
		 var consumNo=getQueryString("consumNo");
		/*  data = new dhtmlXDataStore({
					url:"${base}/admin/assetsConsum/selectAssetConsumGroup.action?consumNo="+consumNo,
					datatype:"json"
				}); */
		   
		grid = new dhtmlXGridObject('gridId');
		// 把 grid 添加到  ID为 grid的div中
		grid.setImagePath("${base}/aufw/resources/common/dhtmlx/imgs/");
		//设置 grid上 图片的路径
		grid.setHeader(" ,资产编号,资产名称,数量");
		//设置 grid每列的标题
		grid.setColumnIds("check,assetsNum,assetsName,consumNum");
		//设置 grid每列的数据  对应 json中的哪条数据
		grid.setInitWidths("30,100,200,*");
		//设置 每列的宽度
		grid.setColTypes("ch,ro,ro,ro");
		
		grid.init();
		
		//grid.sync(data);

		 $.get("${base}/admin/assetsConsum/selectAssetConsumGroup.action?consumNo="+consumNo, function(result){

			if(result.data)
			{
				for (var i = 0, len = result.data.length; i < len; i++) {
					var obj = result.data[i];
					var assetsNum=obj.assetsNum;
					var assetsName=obj.assetsName;
					var consumId=obj.consumId;
					var consumNum=obj.consumNum;
					grid.addRow(consumId,[" ",assetsNum,assetsName,consumNum],1); 
					if(i==0)
					{
						
						$('#consumNo').val(obj.consumNo);
						$('#consumBy').val(obj.consumBy);
						$('#remark').val(obj.remark);
						$('#consumDate').val(obj.consumDate);
						$('#consumDep').val(obj.consumDep);
						
					}
				}
			}
         });
		 
		/*  grid.attachEvent("onEditCell", function(stage,rId,cInd,nValue,oValue){
			 if(stage==2)  //编辑cell时
			 {
				 var rowArr = rId.split('$$$');
	              var maxAmount=parseInt(rowArr[1]);
	              if(isNaN(nValue))
	             {
	            	  alert("修改数量要为数字！");
	            	  return false;
	            	}
	              if(nValue>maxAmount)
	              {
	            	
	            	alert("修改数量不能大于该资产未使用数量");
	                
	                return false;
	              }else{
	            	  return true;
	              }
	              
				 
				// alert("stage:"+stage+rId+"  "+cInd+" nValue:"+nValue+" oValue:"+oValue);
			 }
			 return true;
		 }); */
		 
		 
		// setRandNums("consumNo","CO");

	}

    $(function(){
    	init();
    	layout();
    	$(window).resize(function(){
    		layout();
    	});
    	
    	
    });
    
    function layout(){
    	$('#remark').width($('.consum_wrap').width()-84);	
    }
    
    function closeWin(){
    	window.top.closeWin('editAssetsconsul');
    }
    
/*     function addRelnum(id){
    	var newTime=new Date().getTime();
    	$('#'+id).parent().parent().parent('.relnum').after("<div class='relnum'><div class='clearfix consum_block'><div class='consum_inline clearfix'><label for="+"assetsNum"+newTime+">资产编号</label><input id="+"assetsNum"+newTime+" type='text'  /></div><div class='consum_inline_right clearfix'><label for="+"assetsName"+newTime+">资产名称</label><input id="+"assetsName"+newTime+" type='text' /></div></div><div class='clearfix consum_block'><div class='consum_inline clearfix'><label for="+"consumNum"+newTime+">领用数量</label><input id="+"consumNum"+newTime+" type='text' /></div><div class='consum_inline_right clearfix'><a "+"onclick=addRelnum("+"'"+"assetsNum"+newTime+"'"+") href='javascript:void(0)' class='relnum_a'>增加</a><a "+"onclick=delRelnum("+"'"+"assetsNum"+newTime+"'"+") href='javascript:void(0)' class='relnum_a'>删除</a></div></div></div>");
    	layout();
    } */
    
	function delRelnum(id){
		if($('.relnum').length==1){
			$.dialog.tips("资产不能为空！");
		}else{
			$('#'+id).parent().parent().parent('.relnum').remove();	
			layout();
		}		
    }
	
	//选择资产
	function selectAsset(amountIndex) {
		var url =  "${base}/admin/assetsRegister/assetsSelect.action?amountIndex="+amountIndex+"&from=page";
		window.top.createWindow({
			id:"assetsSelect",
			text: "资产选择",
			width: 670,
			height: 450,
			url: url,
			parent_ifr : window
		});
	}
	
	//删除资产
	function delAsset()
	{
	   var row_id = grid.getCheckedRows(0);
		if (row_id === '') {
	           $.dialog.tips('请至少选择一条数据！');
	            return;
	        }
		//console.log(row_id);
		
		var delRowId = "" ;
		row_id = row_id.split(',');
		//alert(row_id.length);
		for(i=0;i<row_id.length;i++){
			grid.deleteRow(row_id[i]);
		}

	}
    
    function formSubmit(){
    	var consumNo=$('#consumNo').val();
    	if(!consumNo)
    	{
    		$.dialog.tips("领用编号不能为空！");
    		return;
    	}
    	var consumBy=$.trim($('#consumBy').val());//领用人
    	if(consumBy==""){
    		$.dialog.tips("领用人不能为空！");
    		$("#consumBy").select();
    		return;
    	}
    	var consumDep=$.trim($('#consumDep').val());//领用人部门
    	/* if(consumDep==""){
    		$.dialog.tips("领用人部门不能为空！");
    		$("#consumDep").select();
    		return;
    	} */
    	var consumDate=$.trim($('#consumDate').val());//领用时间
    	if(consumDate==""){
    		$.dialog.tips("领用时间不能为空！");
    		$("#consumDate").select();
    		return;
    	}
    
    	var remark = $("#remark").val();
    	
    $.post("${base}/admin/assetsConsum/updateAssetsConsumGroup.action", 
    	    {
 		      "assetsConsum.consumBy":consumBy,
 		      "assetsConsum.consumDep":consumDep,
 		      "assetsConsum.consumDate":consumDate,
 		      "assetsConsum.consumNo":consumNo,
 		     "assetsConsum.remark":remark
    	  }, function(result){
    	       $.dialog.tips(result.tips);
    	       ParentIframe.refresh_data();
    	      setTimeout(function(){      			
    	       closeWin();
    	  },200);
    }); 	
    	
    	
    }
    
   
    
</script>
</html>