<!doctype html>
<html style="height:100%;overflow:hidden;">
<head>
<title>知识问答</title>
<meta charset="utf-8">
    <title>知识收藏</title>
    <link rel="stylesheet" type="text/css" href="${base}/aufw/resources/common/css/base.css">
    <link rel="stylesheet" type="text/css" href="${base}/aufw/resources/common/artDialog/skins/default.css">
    <link rel="stylesheet" type="text/css" href="${base}/aufw/resources/common/dhtmlx/dhtmlx.css">
    <script src="${base}/aufw/resources/common/js/setskins.js"></script>
    <script>
        setSkinsCss("listCss,iconCss");
    </script>
    <link rel="stylesheet" type="text/css" href="${base}/aufw/resources/common/dhtmlx/dhtmlx.css">
    <link rel="stylesheet" type="text/css" href="${base}/aufw/resources/common/artDialog/skins/default.css">
     <script src="${base}/aufw/resources/common/js/jquery.js"></script>
    <script src="${base}/aufw/resources/common/artDialog/jquery.artDialog.js"></script>
    <script src="${base}/aufw/resources/common/dhtmlx/dhtmlx.js"></script>
    <script src="${base}/aufw/resources/common/dhtmlx/dhtmlxtree_srnd.js"></script>
    <script src="${base}/aufw/resources/common/dhtmlx/dhtmlxgrid_pgn.js"></script>
    <script src="${base}/aufw/resources/common/dhtmlx/eden.js"></script>
    <script src="${base}/aufw/resources/common/js/My97DatePicker/WdatePicker.js"></script>
    <script src="${base}/form/fceform/js/MicrosoftAjax.js"></script>
    <script src="${base}/form/fceform/js/fcpub.js"></script>
    <script src="${base}/form/fceform/js/fcrundj.js"></script>
    <script src="${base}/form/fceform/js/tabpane.js"></script>
    <script src="${base}/aufw/resources/common/js/plupload/plupload.full.js"></script>
<style>
*{ margin:0; padding:0;}
li{ list-style:none;}
a{ text-decoration:none; outline:none;}

body{background-color:#f1f1f1;}
.top{ min-width:980px; width:auto !important; width:980px; height:0; background-color:#09345d;display:none;}
.top_box{ width:850px; height:88px; margin:0 auto; overflow:hidden;}
.title{ display:block; float:left; font-size:26px; font-family:"微软雅黑"; color:#fff; line-height:88px; letter-spacing:4px; margin-left:15px; margin-right:110px; }
.search_box{ float:left; margin-top:31px;}
.search01{ width:350px; height:33px; background-color:#fff; border:1px solid #eaeaea; font-size:14px; line-height:33px; font-family:"微软雅黑";float:left;}
.search_btn01{ border:none; vertical-align:middle;float:left;}
.Ask{ float:left; margin-left:24px; margin-top:31px; }
.Ask a{ display:block; width:120px; height:35px; border-radius:8px; background-color:#2c6aa6; color:#fff; line-height:35px; text-align:center; font-size:16px; font-family:"微软雅黑";}
.Ask a:hover{  background-color:#277aca;}



.container{ background-color:#fff;  width:auto !important;}
.C_box{ width:734px; height:auto; margin:0 auto;}
.C_box_title{ padding-top:10px; width:723px; height:29px; border-bottom:1px solid #eeeeee;margin:0 auto;}
.all{ display:block; float:left; width:87px; border-bottom:2px solid #09345d; font-size:16px; font-family:"微软雅黑";  color:#09345d; line-height:27px; text-align:center;margin-right:5px;}
.already{display:block; float:left; margin-right:5px; width:87px; border-bottom:2px solid #808080; font-size:14px; font-family:"微软雅黑";  color:#808080; line-height:27px; text-align:center;}

.question{ width:723px; height:auto; padding-top:5px; margin:0 auto;}
.question ul li{ width:718px; border:1px solid #c7e4ff; padding-top:5px; padding-left:5px; margin-bottom:14px;}
.Q_top{ width:718px; height:auto; overflow:hidden;}
.head_pic{ width:50px; height:50px; float:left; margin-right:15px;}
.Q_content{ width:628px; height:auto; float:left;}
.Q_title{ display:block; font-size:14px; font-weight:bold; color:#2c6aa6; margin-bottom:8px;}
.Q_title:hover{ text-decoration:underline;}
.Q_detials{display:block; font-size:14px; color:#666666; margin-bottom:13px;}
.Q_bottom{ width:701px; overflow:hidden; padding-bottom:4px;}
.Q_bottom_left{ float:left;}
.Q_bottom_left a{font-size:12px; color:#b0b0b0;}
.Q_bottom_right{ float:right;}
.answer{ display:block; float:left; width:55px; height:22px; border-radius:6px;background-color:#2c6aa6; font-size:14px; color:#fff; line-height:22px; text-align:center; margin-right:2px;}
.answer:hover{background-color:#1e92f5;}
.delelte{display:block; float:left; width:55px; height:22px; border-radius:6px; background-color:#2c6aa6; font-size:14px; color:#fff; line-height:22px; text-align:center;}
.delelte:hover{background-color:#1e92f5;}
.Answers{ width:701px; border-top:1px dashed #999999; padding-top:10px; padding-bottom:10px;}
.Answers a{ font-size:14px; line-height:26px; }
.Answers_1{font-weight:bold; color:#666666;}
.Answers_2{ color:#ee7c59;}
.page{text-align:right;padding-top:18px;}
.page a{ font-size:14px; font-family:"微软雅黑"; color:#09345d; margin-right:10px;}
.page a:hover{ color:#09F;}

.c-question{position:absolute;right:5px;top:10px;width:80px;height:25px;background:#3b80c2;display:block;color:#fff;text-align:center;line-height:25px;}

</style>

</head>

<body style="height:100%;overflow:auto;">
<div class="top">
	<div class="top_box">
    	<a class="title">知识问答</a>
        <div class="search_box">
        	<input id="title" class="search01" ><input class="search_btn01" type="image" src="${base}/oa/page/knowledge/question/images/search_btn01.png" onclick="SimpleSearch();">
        </div>
        <div class="Ask"><a href="javascript:void(0)" onclick="createQuestion();">我要提问</a></div>
    </div>	
</div>
<div class="container">
	<div class="C_box">
    	<div class="C_box_title" style="position:relative;">
        	<a class="all" href="javascript:void(0)" onclick="selectType('1')">全部问题</a>
        	<a class="already" href="javascript:void(0)" onclick="selectType('2')">已回答问题</a>
        	<a class="already" href="javascript:void(0)" onclick="selectType('3')">我的问题</a>
        	<a href="javascript:void(0)" onclick="createQuestion();" class="c-question">我要提问</a>
        </div>
        <div class="page clearfix"><a href="javascript:void(0)" onclick="previous()">上一页 </a> <a href="javascript:void(0)" onclick="next()">下一页</a></div>
        <div class="question">
        	<ul id="questionGrid">
            	
            	
            </ul>
            
        </div>
    </div>
</div>
<script type="text/javascript">
	var baseDataURL="${base}/admin/question/fetchByCriteria.action?a=1";
	var pageCount=4;
	var currentPage=0;
	var totalCount=0;
	var title="";
	var type=1;
	$(function(){
		loadContext();
		
		
		$('.container').height($(window).height()-$('.top').outerHeight(true));
		$('.C_box_title a').bind('click',function(){
			$('.C_box_title a').removeClass('all');
			$('.C_box_title a').addClass('already');
			$(this).addClass('all');
			$(this).removeClass('already');
		});
	});
	
	function selectType(type){
		window.type=type;
		loadContext();
	}
	
	function clearPage(){
		window.currentPage=0;
		window.totalCount=0;
	}
	
	function previous(){
		if(currentPage<=0){
			return;
		}else{
			currentPage=currentPage-1;
		}
		loadContext();
	}
	
	function next(){
		if(totalCount<=(currentPage+1)*pageCount){
			return;
		}else{
			currentPage=currentPage+1;
		}	
		loadContext();
	}
	function loadContext(){
		jQuery.post(baseDataURL+"&etc="+new Date().getTime(), 
    			{ "pageCount":pageCount,"posStart":currentPage*pageCount ,"title":title,"type":type}, function (loader) {
    				fillContext(loader,$("#questionGrid"));
		},"json");      	
	}
	
	function fillContext(jsonData,obj){
		if(jsonData.result=="success"){
			totalCount=jsonData.totalCount;
			obj.empty();
			var data=jsonData.data;
			var accoutName=jsonData.accoutName;
			for(var key in data){
				var item=data[key];
				var ele="<li><div class='Q_top'><div class='head_pic'><img src='${base}/oa/page/knowledge/question/images/head.png'></div><div class='Q_content'>";
				ele+="<a class='Q_title' href='javascript:void(0)' onclick='answer(&quot;"+item.id+"&quot;)'>"+item.questionTitle+"</a>";
				ele+="<a class='Q_detials' >"+item.questionContent+"</a> </div></div>";
				ele+=" <div class='Q_bottom'><div class='Q_bottom_left'><a>提问者："+item.createBy+" </a><a> "+item.questionDate+"</a></div>";
				ele+="<div class='Q_bottom_right'><a class='answer' href='javascript:void(0)' onclick='answer(&quot;"+item.id+"&quot;)'>回答("+item.answerNum+")</a>";
				//ele+="<a class='delelte' href='javascript:void(0)' onclick='deleteQuestion(&quot;"+item.id+"&quot;)'>删除</a>";
				if(item.operate!=null||item.createBy==accoutName){
					ele+="<a class='delelte' href='javascript:void(0)' onclick='deleteQuestion(&quot;"+item.id+"&quot;)'>删除</a>";
				}
				
				ele+="</div> </div>	</li>";
				obj.append(ele);
			}
			
		}else{
			$.dialog.tips(jsonData.message);
		}	
	}
		
	function createQuestion(){
		window.top.createWindow(
				{   id      :'questionWin',
					text    : "提问",
					url     : "${base}/admin/question/questionPage.action",
					width   :'880',
					height  :'500',
					parent_ifr : window
				}
			);
	}
	function answer(id){
		window.top.createWindow(
				{   id      :'answerWin',
					text    : "回答",
					url     : "${base}/admin/answer/answerPage.action?knowledgeAnswer.id="+id,
					width   :'880',
					height  :'500',
					parent_ifr : window
				}
			);
	}
	
	function deleteQuestion(id){
		$.post("${base}/admin/question/delete.action?etc"+new Date().getTime(), {"id":id}, function(result){
            if(result.result=="success"){
            	SimpleSearch();
            }
            $.dialog.tips(result.message);
        });
	}
	
	function SimpleSearch(){
		title=$("#title").val();
		clearPage();
		loadContext();
	}
</script>
</body>
</html>
